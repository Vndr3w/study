# Домашнее задание к занятию «Репликация и масштабирование. Часть 2» - Лукинов Андрей

## Задание 1

Опишите основные преимущества использования масштабирования методами:

- активный master-сервер и пассивный репликационный slave-сервер; 
- master-сервер и несколько slave-серверов;


<details>
<summary>Ответ</summary>

*Дайте ответ в свободной форме.*

Масштабирование с использованием активного master-сервера и пассивного slave-сервера обеспечивает базовую отказоустойчивость и разделение нагрузки. Записи идут только на master, а slave используется для чтения или как горячая резервная копия.

**Основные преимущества:**

- *Отказоустойчивость:* При сбое master можно быстро переключиться на slave, минимизируя простой.
- *Разделение нагрузки:* Чтение распределяется на slave, разгружая master от SELECT-запросов.
- *Простота настройки:* Минимальная конфигурация репликации без сложной координации.​

При master и нескольких slave преимущества усиливаются за счет параллелизма. Добавление slave позволяет масштабировать чтение горизонтально.​

**Дополнительные преимущества:**

- *Масштабируемость чтения:* Каждый slave обрабатывает часть SELECT, повышая общую пропускную способность.
- *Геораспределение:* Slave можно разместить ближе к пользователям для снижения latency.​
- *Резервирование:* Множественные slave позволяют автоматический failover с выбором лидера.

</details>

## Задание 2

Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц: 

- пользователи, 
- книги, 
- магазины (столбцы произвольно). 

Опишите принципы построения системы и их разграничение или разбивку между базами данных.

<details>
<summary>Ответ</summary>

*Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.* 

База данных с таблицами пользователи (id, name, email, region), книги (id, title, author, store_id, price) и магазины (id, name, location) шардируется для распределения нагрузки. Вертикальный шардинг разделяет таблицы по серверам по функционалу, горизонтальный — данные внутри таблиц по ключу (например, по region или id).

**Принципы построения:**

- *Вертикальный шардинг:* "Пользователи" на DB1 (региональные данные), "магазины" на DB2 (справочники), "книги" на DB3 (основной ассортимент с JOIN по store_id). Это минимизирует кросс-серверные JOIN.​
- *Горизонтальный шардинг:* В "пользователи" и "книги" — по hash(user_id) или region на шарды (DB1-shard1/2 для EU, DB1-shard3/4 для RU). "Магазины" — без шардов, как lookup-таблица.
- *Разграничение:* Приложение маршрутизирует запросы по ключу шарда (directory-based). Репликация master-slave на каждом шарде для чтения.​
- *Режимы серверов:* Master для записи (async реплика), slaves для чтения (read-only). Failover через HAProxy или Consul.

**Блок-схема системы (текстовое представление):**

[Application Layer]
    |
    +--> Router (hash(region/user_id) -> Shard)
         |
         +-- DB1 (Вертикальное: Пользователи)
         |    +-- Master (write) 
         |    +-- Slave1/Slave2 (read)
         |         Горизонтальное: Shard1 (EU), Shard2 (RU)
         |
         +-- DB2 (Вертикальное: Магазины)
         |    +-- Master (write)
         |    +-- Slave (read, no horiz)
         |
         +-- DB3 (Вертикальное: Книги)
              +-- Master (write)
              +-- Slave1/Slave2 (read)
                   Горизонтальное: Shard1 (id%4=0-1), Shard2 (id%4=2-3)


</details>

## Задание 3*

Выполните настройку выбранных методов шардинга из задания 2.

<details>
<summary>Ответ</summary>

*Пришлите конфиг Docker и SQL скрипт с командами для базы данных*.

Доделаю позже.

</details>